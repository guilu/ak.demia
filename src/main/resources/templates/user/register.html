<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>registers</title>
</head>
<body>

<h1>register</h1>

<form id="register-form" enctype="utf8" method="POST" th:action="@{/user/register}">

  <div>
    <label for="firstName">
      first name
    </label>
    <input id="firstName" name="firstName" value="" required="required" />
    <span id="firstNameError" style="display: none"></span>
  </div>

  <div>
    <label for="lastName">
      last name
    </label>
    <input id="lastName" name="lastName"  value="" required="required" />
    <span id="lastNameError" style="display: none"></span>
  </div>

  <div>
    <label for="email">
      email
    </label>
    <input id="email" type="email" name="email" value="" required="required" />
    <span id="emailError" style="display: none"></span>
  </div>

  <div>
    <label for="password">
      password
    </label>
    <input id="password" name="password" value="" type="password" required="required" autocomplete="new-password" />
    <span id="passwordError" style="display: none"></span>
  </div>

  <div>
    <label for="matchPassword">
      confirm password
    </label>
    <input id="matchPassword" class="form-control" name="matchingPassword" value="" type="password" required="required" autocomplete="new-password" />
    <span id="globalError" style="display: none"></span>
  </div>

  <button type="submit">
    submit
  </button>
</form>

  <ul>
    <li><a th:href="@{/}" th:id="home_link" th:text="#{menu.home}">Inicio</a></li>
  </ul>

<script lang="javascript">

    window.addEventListener("DOMContentLoaded", function() {

        let form = document.getElementById("register-form");
        let data = new FormData(form);

        document.addEventListener('submit', function (event) {
           event.preventDefault();

           console.log("procesando envÃ­o manual");

           fetch('/user/register',{
               method: 'POST',
               body: new FormData(event.target)
           }).then( (response) => {
               if (response.ok) {
                  return response.json()
               }
               return Promise.reject(response);
           }).then(function (data){
               //success:
               //redirectUrl:
               //code:
               //message:
               console.log('redirecting-to-'+data.redirectUrl);
               window.location.href = data.redirectUrl;

           }).catch(function (error) {
               console.error(error)
           })
        });

    });
</script>

</body>
</html>